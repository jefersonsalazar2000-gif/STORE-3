<!DOCTYPE html>
<html lang="es" class="h-full bg-[#0b0f1a]">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J_A MEGA STORE 360</title>
  <meta name="theme-color" content="#0b0f1a"/>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { outfit: ['Outfit','ui-sans-serif','system-ui']},
          colors: { base:'#0b0f1a', card:'#12172a', soft:'#1a2140' }
        }
      }
    }
  </script>

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">

  <!-- Estilos -->
  <style>
    :root{
      --grad-1: linear-gradient(135deg,#00E5FF 0%, #7C3AED 50%, #FF0099 100%);
      --btn-grad: linear-gradient(135deg, #00E5FF 0%, #7C3AED 50%, #FF0099 100%);
      --ring: 0 0 0 1.5px rgba(124,58,237,.45), 0 0 18px rgba(124,58,237,.35), inset 0 0 12px rgba(0,229,255,.25);
    }
    body{ font-family:'Outfit',sans-serif }
    .neon-title{ background:var(--grad-1); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 18px rgba(124,58,237,.25) }
    .btn-neon{ background:var(--btn-grad); color:#0b0f1a; font-weight:800; box-shadow:0 0 24px rgba(124,58,237,.35); transition:transform .12s, box-shadow .12s, opacity .12s }
    .btn-neon:hover{ transform:translateY(-1px) scale(1.01); box-shadow:0 0 32px rgba(124,58,237,.55) }
    .chip{ background:rgba(124,58,237,.15); border:1px solid rgba(124,58,237,.35) }
    .card{ background:radial-gradient(1200px 500px at -10% -10%, rgba(124,58,237,.12), transparent 50%), radial-gradient(1000px 400px at 120% 120%, rgba(0,229,255,.10), transparent 45%), #12172a; border:1px solid rgba(124,58,237,.25) }
    .toolbar{ background:linear-gradient(180deg, rgba(18,23,42,.85), rgba(18,23,42,.6) 60%, rgba(18,23,42,.1)); border-bottom:1px solid rgba(124,58,237,.25); backdrop-filter:blur(8px) }
    .gradient-border{ position:relative; border-radius:16px; overflow:hidden }
    .gradient-border::before{ content:''; position:absolute; inset:0; padding:1px; border-radius:16px; background:var(--grad-1);
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite:xor; mask-composite:exclude; pointer-events:none }
    .input{ background:#0e1430; border:1px solid rgba(124,58,237,.35); outline:none; color:white; border-radius:12px; padding:.7rem .9rem }
    .input:focus{ box-shadow:var(--ring) }
    .tag{ background:rgba(10,239,255,.12); border:1px solid rgba(10,239,255,.35) }
  </style>
</head>

<body class="min-h-full text-white bg-[radial-gradient(1200px_600px_at_20%_-10%,rgba(124,58,237,.15),transparent_55%),radial-gradient(900px_500px_at_120%_10%,rgba(0,229,255,.12),transparent_50%),#0b0f1a]">

  <!-- Header -->
  <header class="toolbar sticky top-0 z-30">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="w-10 h-10 rounded-xl gradient-border flex items-center justify-center shrink-0">
        <div class="w-full h-full rounded-[14px] bg-[#0e1430] flex items-center justify-center">
          <span class="text-xl font-extrabold">J_A</span>
        </div>
      </div>
      <div class="flex-1">
        <h1 class="text-xl sm:text-2xl font-extrabold neon-title leading-none">MEGA STORE 360</h1>
        <p class="text-xs text-white/70 -mt-0.5">De todo • Tecnología • Hogar • Accesorios</p>
      </div>

      <a href="http://www.youtube.com/@SABIDURIAANIMAL86" target="_blank" class="px-3 py-2 rounded-xl chip text-sm font-semibold hover:opacity-90">YouTube</a>
    </div>
  </header>

  <!-- Controles -->
  <section class="max-w-7xl mx-auto px-4 mt-4 grid gap-3 sm:grid-cols-[1fr_auto]">
    <div class="gradient-border">
      <input id="search" class="input w-full" placeholder="Buscar productos… (ej. iPhone, smartwatch)" />
    </div>
    <select id="categoryFilter" class="input">
      <option value="all">Todas las categorías</option>
    </select>
  </section>

  <!-- Grid -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="grid" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
    <p id="empty" class="hidden text-center text-white/60 mt-10">No hay productos que coincidan.</p>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/10 py-8">
    <div class="max-w-7xl mx-auto px-4 text-sm text-white/60">
      <div class="flex flex-wrap items-center gap-2">
        <span class="font-semibold">Aviso Amazon Afiliados:</span>
        <span>Como afiliado de Amazon, puedo ganar comisiones por compras calificadas.</span>
      </div>
      <div class="mt-2">© <span id="year"></span> J_A MEGA STORE 360 — Todos los derechos reservados.</div>
    </div>
  </footer>

  <!-- Lógica -->
  <script>
    const AFFILIATE_TAG_DEFAULT = "kaninosabioan-20";
    const PRODUCTS_URL = "./products.json"; // <- el archivo del repo que todos verán

    const grid = document.getElementById('grid');
    const empty = document.getElementById('empty');
    const search = document.getElementById('search');
    const categoryFilter = document.getElementById('categoryFilter');
    const year = document.getElementById('year');
    year.textContent = new Date().getFullYear();

    let products = [];

    // Render helpers
    function renderCategories(list){
      const cats = ['all', ...new Set(list.map(p=>p.category))];
      categoryFilter.innerHTML = cats.map(c => `<option value="${c}">${c==='all'?'Todas las categorías':c}</option>`).join('');
    }

    function productCard(p){
      const price = p.price?`$${Number(p.price).toLocaleString()}`:'';
      const tag = p.featured?`<span class="tag text-xs px-2 py-1 rounded-lg font-semibold">Destacado</span>`:'';
      const brand = p.brand?`<span class="text-xs text-white/60">${p.brand}</span>`:'';
      return `
        <article class="card rounded-2xl p-3 sm:p-4 flex flex-col gradient-border">
          <div class="rounded-xl overflow-hidden bg-soft aspect-[4/3]">
            <img src="${p.image}" alt="${p.title}" class="w-full h-full object-cover" loading="lazy" />
          </div>
          <div class="mt-3 flex items-start justify-between gap-3">
            <div class="min-w-0">
              <h3 class="font-extrabold leading-tight line-clamp-2">${p.title}</h3>
              <div class="flex items-center gap-2 mt-1">${brand}${brand?'<span class="text-white/20">•</span>':''}<span class="text-xs text-white/60">${p.category}</span>${p.featured?'<span class="text-white/20">•</span>'+tag:''}</div>
              ${price?`<div class="mt-1 text-white/90 font-semibold">${price}</div>`:''}
            </div>
          </div>
          <div class="mt-3">
            <a href="${ensureTag(p.amazon)}" target="_blank" rel="nofollow sponsored noopener" class="btn-neon w-full justify-center px-4 py-2 rounded-xl inline-flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12.001 2c3.86 0 7 3.141 7 7.001 0 3.86-3.14 7-7 7a1 1 0 1 1 0-2c2.761 0 5-2.239 5-5 0-2.762-2.239-5.001-5-5.001-2.762 0-5.001 2.239-5.001 5.001a1 1 0 1 1-2 0C5 5.141 8.141 2 12.001 2z"/><path d="M12 13a1 1 0 0 1 1 1v5.586l1.293-1.293a1 1 0 0 1 1.414 1.414l-3 3a.998.998 0 0 1-1.414 0l-3-3a1 1 0 1 1 1.414-1.414L11 19.586V14a1 1 0 0 1 1-1z"/></svg>
              Ver en Amazon
            </a>
          </div>
        </article>`;
    }

    function ensureTag(url){
      if(!url) return "#";
      const hasTag = /[?&]tag=/.test(url);
      if(hasTag) return url;
      const sep = url.includes('?') ? '&' : '?';
      return `${url}${sep}tag=${AFFILIATE_TAG_DEFAULT}`;
    }

    function applyFilters(){
      const term = (search.value||'').toLowerCase().trim();
      const cat = categoryFilter.value||'all';
      const filtered = products.filter(p=>{
        const t = !term || p.title.toLowerCase().includes(term) || (p.brand||'').toLowerCase().includes(term);
        const c = cat==='all' || p.category===cat;
        return t && c;
      });
      grid.innerHTML = filtered.map(productCard).join('');
      empty.classList.toggle('hidden', filtered.length>0);
    }

    // Cargar productos.json (siempre igual para todos)
    async function loadProducts(){
      const resp = await fetch(`${PRODUCTS_URL}?v=${Date.now()}`); // anti-caché
      if(!resp.ok) throw new Error('No se pudo cargar products.json');
      const data = await resp.json();
      products = data.map(p => ({ ...p })); // ya vienen con id opcional
      renderCategories(products);
      applyFilters();
    }

    search.addEventListener('input', applyFilters);
    categoryFilter.addEventListener('change', applyFilters);

    loadProducts().catch(err=>{
      console.error(err);
      empty.classList.remove('hidden');
      empty.textContent = 'No se pudieron cargar los productos.';
    });
  </script>
</body>
</html>
