<!DOCTYPE html>
<html lang="es" class="h-full bg-[#0b0f1a]">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J_A MEGA STORE 360 — Amazon Afiliados</title>

  <!-- SEO básico -->
  <meta name="description" content="J_A MEGA STORE 360: productos ganadores, los más buscados, con tu enlace de Amazon Afiliados.">
  <meta name="keywords" content="Amazon afiliados, tienda, mejores productos, tecnología, J_A MEGA STORE 360">
  <meta name="robots" content="index,follow">

  <!-- Open Graph para que en WhatsApp/Facebook muestren la imagen correcta -->
  <meta property="og:title" content="J_A MEGA STORE 360 — Tienda de Afiliados" />
  <meta property="og:description" content="Descubre los productos más buscados y ve a Amazon con tu enlace de afiliado." />
  <meta property="og:image" content="https://images.unsplash.com/photo-1516387938699-a93567ec168e?q=80&w=1200&auto=format&fit=crop" />
  <meta property="og:type" content="website" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { outfit: ['Outfit','ui-sans-serif','system-ui'] },
          boxShadow: {
            glow: '0 0 25px rgba(99,102,241,0.35), 0 0 45px rgba(236,72,153,0.25)'
          },
          backgroundImage: {
            'grad-neo': 'linear-gradient(135deg, #6366F1 0%, #8B5CF6 35%, #EC4899 70%, #F59E0B 100%)',
            'grad-neo-soft': 'linear-gradient(135deg, rgba(99,102,241,0.15), rgba(236,72,153,0.15))'
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root { color-scheme: dark; }
    body { font-family: 'Outfit', sans-serif; }
    .btn-neo {
      @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold transition-transform active:scale-95 shadow-glow text-white;
      background-image: linear-gradient(135deg,#6366F1,#8B5CF6,#EC4899,#F59E0B);
      background-size: 300% 300%;
      animation: move 6s ease infinite;
    }
    .btn-ghost {
      @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold border border-white/15 text-white/90 hover:bg-white/5;
    }
    @keyframes move { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
    .line-clamp-2 {
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
    }
    dialog::backdrop { background: rgb(0 0 0 / 0.6); }
  </style>

  <!-- Firebase SDKs (Compat para facilidad) -->
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="min-h-full text-white">
  <!-- NAV -->
  <header class="sticky top-0 z-40 border-b border-white/10 backdrop-blur bg-[#0b0f1a]/70">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div class="h-10 w-10 rounded-xl ring-2 ring-white/15 overflow-hidden">
        <img src="https://images.unsplash.com/photo-1543466835-00a7907e9de1?q=80&w=200&auto=format&fit=crop" alt="logo" class="h-full w-full object-cover">
      </div>
      <div class="flex-1">
        <h1 class="text-lg sm:text-xl font-extrabold tracking-tight">J_A MEGA STORE <span class="text-white/60">360</span></h1>
        <p class="text-xs text-white/60 -mt-0.5">Productos ganadores — Amazon Afiliados</p>
      </div>
      <div class="hidden sm:flex items-center gap-2">
        <a id="btnYoutubeTop" target="_blank" rel="noopener" class="btn-ghost">YouTube</a>
        <button id="btnAdmin" class="btn-ghost" title="Modo Admin">Admin</button>
      </div>
      <button id="btnAdminSm" class="sm:hidden btn-ghost" title="Modo Admin">Admin</button>
    </div>
  </header>

  <!-- HERO -->
  <section class="relative">
    <div class="absolute inset-0 bg-grad-neo-soft pointer-events-none"></div>
    <div class="max-w-7xl mx-auto px-4 py-8 sm:py-10 grid md:grid-cols-[1.2fr,0.8fr] gap-6 items-center">
      <div>
        <h2 class="text-2xl sm:text-4xl font-black leading-tight">
          Encuentra <span class="text-transparent bg-clip-text bg-grad-neo">los más buscados</span> y compra con tu enlace de Amazon
        </h2>
        <p class="mt-3 text-white/80">
          100% responsive: lo que ves en tu web es lo mismo que verán en su teléfono.
        </p>

        <!-- Buscador -->
        <div class="mt-5 flex gap-2">
          <input id="searchInput" type="search" placeholder="Buscar por nombre o categoría…" class="flex-1 rounded-xl bg-white/5 border border-white/10 px-4 py-3 outline-none focus:ring-2 focus:ring-fuchsia-400/40">
          <button id="clearSearch" class="btn-ghost">Limpiar</button>
        </div>

        <!-- Botones -->
        <div class="mt-4 flex flex-wrap gap-2">
          <button id="btnAdd" class="btn-neo hidden">+ Añadir producto</button>
          <a id="btnYoutube" target="_blank" rel="noopener" class="btn-neo">Ir al canal YouTube</a>
          <button id="btnQR" class="btn-ghost">QR del canal</button>
        </div>

        <!-- Aviso Amazon -->
        <p class="mt-3 text-xs text-white/60">
          Aviso: Como Asociado de Amazon, puedo ganar comisiones por compras que califiquen.
        </p>
      </div>

      <!-- Perro y Gato portada -->
      <div class="relative">
        <div class="aspect-[4/3] sm:aspect-[5/4] rounded-2xl overflow-hidden ring-2 ring-white/10 shadow-glow">
          <img src="https://images.unsplash.com/photo-1511735111819-9a3f7709049c?q=80&w=1200&auto=format&fit=crop" alt="Perro y gato" class="h-full w-full object-cover">
        </div>
      </div>
    </div>
  </section>

  <!-- FILTROS RÁPIDOS -->
  <section class="max-w-7xl mx-auto px-4">
    <div class="flex flex-wrap gap-2">
      <button data-cat="all" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10">Todo</button>
      <button data-cat="Tecnología" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10">Tecnología</button>
      <button data-cat="Hogar" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10">Hogar</button>
      <button data-cat="Fitness" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10">Fitness</button>
      <button data-cat="Mascotas" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10">Mascotas</button>
      <button data-cat="Gaming" class="px-3 py-1.5 rounded-lg bg-white/5 border border-white/10 text-sm hover:bg-white/10">Gaming</button>
    </div>
  </section>

  <!-- GRID -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
    <div id="empty" class="hidden mt-8 text-center text-white/60">No hay resultados.</div>
  </main>

  <!-- FOOTER -->
  <footer class="border-t border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-6 text-sm text-white/60">
      © <span id="year"></span> J_A MEGA STORE 360 · <span class="text-white/70">Amazon Afiliados</span> ·
      <a href="#" class="underline decoration-white/20 hover:decoration-white/60">Política de privacidad</a>
    </div>
  </footer>

  <!-- MODAL: FORM PRODUCTO -->
  <dialog id="dlgForm" class="rounded-2xl p-0 w-[min(680px,96vw)] bg-[#0b0f1a] border border-white/10">
    <form method="dialog" id="productForm">
      <div class="p-5 border-b border-white/10 flex items-center justify-between">
        <h3 class="text-lg font-bold">Producto</h3>
        <button id="btnCloseForm" class="btn-ghost">Cancelar</button>
      </div>
      <div class="p-5 grid sm:grid-cols-2 gap-4">
        <div class="sm:col-span-2">
          <label class="text-sm text-white/70">Título</label>
          <input id="fTitle" required class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2">
        </div>
        <div>
          <label class="text-sm text-white/70">Categoría</label>
          <input id="fCat" list="cats" required class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2">
          <datalist id="cats">
            <option>Tecnología</option><option>Hogar</option><option>Fitness</option><option>Mascotas</option><option>Gaming</option>
          </datalist>
        </div>
        <div>
          <label class="text-sm text-white/70">Precio (opcional)</label>
          <input id="fPrice" type="number" min="0" step="0.01" class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2">
        </div>
        <div class="sm:col-span-2">
          <label class="text-sm text-white/70">Imagen (URL)</label>
          <input id="fImg" required class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="https://...">
        </div>
        <div class="sm:col-span-2">
          <label class="text-sm text-white/70">URL Amazon (tu producto)</label>
          <input id="fUrl" required class="w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2" placeholder="https://www.amazon.com/dp/ASIN...">
          <p class="text-xs text-white/50 mt-1">Se agregará tu tag afiliado automáticamente: <code id="tagPreview">kaninosabioan-20</code></p>
        </div>
        <input type="hidden" id="fId">
      </div>
      <div class="p-5 border-t border-white/10 flex justify-end gap-2">
        <button value="cancel" class="btn-ghost">Cancelar</button>
        <button id="btnSave" value="default" class="btn-neo">Guardar</button>
      </div>
    </form>
  </dialog>

  <!-- MODAL: QR -->
  <dialog id="dlgQR" class="rounded-2xl p-0 w-[min(520px,96vw)] bg-[#0b0f1a] border border-white/10">
    <div class="p-5 border-b border-white/10 flex items-center justify-between">
      <h3 class="text-lg font-bold">Escanea para ir al canal</h3>
      <button id="btnCloseQR" class="btn-ghost">Cerrar</button>
    </div>
    <div class="p-5 flex items-center justify-center">
      <img id="qrImg" alt="QR YouTube" class="w-72 h-72 object-contain">
    </div>
    <div class="p-5 border-t border-white/10 text-center text-xs text-white/60">
      Si no abre, usa el botón “Ir al canal YouTube”.
    </div>
  </dialog>

  <script>
  // =========================
  // CONFIGURACIÓN EDITABLE
  // =========================
  const YOUTUBE_URL = "http://www.youtube.com/@SABIDURIAANIMAL86";
  const AMAZON_TAG  = "kaninosabioan-20"; // Tu tag afiliado
  // Pega tu firebaseConfig abajo (reemplaza null por tu objeto; sin esto, cada dispositivo mantiene sus propios datos)
  // const firebaseConfig = { apiKey:"...", authDomain:"...", projectId:"...", storageBucket:"...", messagingSenderId:"...", appId:"..." };
  const firebaseConfig = null; // <<< PÉGALO AQUÍ

  // =========================
  // UTILIDADES / ELEMENTOS
  // =========================
  const $ = (q,root=document)=>root.querySelector(q);
  const $$ = (q,root=document)=>[...root.querySelectorAll(q)];
  const yearEl = $("#year"); yearEl.textContent = new Date().getFullYear();
  const grid = $("#grid");
  const empty = $("#empty");
  const dlgForm = $("#dlgForm");
  const dlgQR = $("#dlgQR");
  const btnAdd = $("#btnAdd");
  const btnAdmin = $("#btnAdmin");
  const btnAdminSm = $("#btnAdminSm");
  const productForm = $("#productForm");
  const fId = $("#fId"), fTitle = $("#fTitle"), fCat = $("#fCat"), fPrice=$("#fPrice"), fImg=$("#fImg"), fUrl=$("#fUrl");
  const searchInput = $("#searchInput"), clearSearch=$("#clearSearch");
  const btnYoutube = $("#btnYoutube"), btnYoutubeTop=$("#btnYoutubeTop");
  const btnQR = $("#btnQR"), qrImg=$("#qrImg");

  btnYoutube.href = YOUTUBE_URL;
  btnYoutubeTop.href = YOUTUBE_URL;

  // Generar QR simple (no cambia diseño)
  const qrApi = (url) => `https://quickchart.io/qr?text=${encodeURIComponent(url)}&size=512&margin=2`;
  qrImg.src = qrApi(YOUTUBE_URL);

  // =========================
  // Estado
  // =========================
  let ADMIN = false;
  let PRODUCTS = []; // cache local
  let FILTER = { text:"", cat:"all" };

  // Firestore o demo
  let db = null, auth = null, usingDemo = false;

  // =========================
  // DEMO DATA (12 productos)
  // =========================
  const DEMO = [
    {title:"Monitor Curvo 32\" 165Hz", cat:"Tecnología", price:279.99, img:"https://images.unsplash.com/photo-1587202372775-98927b111c78?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0B1X12345"},
    {title:"Escritorio Eléctrico Altura Ajustable", cat:"Hogar", price:199.99, img:"https://images.unsplash.com/photo-1545259741-2ea3ebf61fa7?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0B2X54321"},
    {title:"Teclado Mecánico RGB", cat:"Gaming", price:69.99, img:"https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0K3Y99999"},
    {title:"Auriculares Inalámbricos ANC", cat:"Tecnología", price:129.99, img:"https://images.unsplash.com/photo-1518444082560-5f1d5d3ba1b9?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0H4Z77777"},
    {title:"Cámara de Seguridad 2K", cat:"Hogar", price:59.99, img:"https://images.unsplash.com/photo-1557324232-b8917d3c3dcb?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0A5C55555"},
    {title:"Robot Aspirador", cat:"Hogar", price:179.99, img:"https://images.unsplash.com/photo-1533153088370-9f7f3b1b7d33?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0Z5R22222"},
    {title:"Correa Reflectante para Perros", cat:"Mascotas", price:14.99, img:"https://images.unsplash.com/photo-1548199973-03cce0bbc87b?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0DOG11111"},
    {title:"Comedero Automático Gatos", cat:"Mascotas", price:49.99, img:"https://images.unsplash.com/photo-1555685812-4b943f1cb0eb?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0CAT22222"},
    {title:"Banda de Resistencia Pro", cat:"Fitness", price:19.99, img:"https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0FIT33333"},
    {title:"Mancuernas Ajustables", cat:"Fitness", price:139.99, img:"https://images.unsplash.com/photo-1517341720772-05f3e1e4fe6f?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0FIT44444"},
    {title:"Mouse Gamer 8K DPI", cat:"Gaming", price:39.99, img:"https://images.unsplash.com/photo-1544233726-9f1d2b29d3d1?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0GAM55555"},
    {title:"Silla Ergonómica", cat:"Hogar", price:229.99, img:"https://images.unsplash.com/photo-1524758631624-e2822e304c36?q=80&w=1200&auto=format&fit=crop", url:"https://www.amazon.com/dp/B0CHA66666"},
  ];

  // =========================
  // INICIO
  // =========================
  window.addEventListener('load', async () => {
    // Botones y modales
    document.getElementById("btnCloseQR")?.addEventListener("click", ()=> dlgQR.close());
    document.getElementById("btnQR").addEventListener("click", ()=> dlgQR.showModal());

    // Corregido: Cancelar cierra el modal
    document.getElementById("btnCloseForm").addEventListener("click",(e)=>{ e.preventDefault(); dlgForm.close(); });
    // Corregido: cerrar por ESC y clic fuera
    document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && dlgForm.open) dlgForm.close(); });
    dlgForm.addEventListener('click', (e)=>{
      const rect = dlgForm.getBoundingClientRect();
      const outside = e.clientX < rect.left || e.clientX > rect.right || e.clientY < rect.top || e.clientY > rect.bottom;
      if (outside) dlgForm.close();
    });
    dlgForm.addEventListener("close", ()=> dlgForm.close());

    // Firebase (opcional)
    try {
      if (firebaseConfig && typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
        await auth.signInAnonymously();
        usingDemo = false;
      } else {
        usingDemo = true; // sin config => cada dispositivo mantiene su demo local
      }
    } catch (e) {
      console.warn('Firebase no disponible, usando DEMO.', e);
      usingDemo = true;
    }

    await loadProducts();
    render();
  });

  // =========================
  // CRUD
  // =========================
  async function loadProducts() {
    if (usingDemo) {
      PRODUCTS = DEMO.map((p, i)=> ({ id:`demo-${i}`, ...p }));
      return;
    }
    const snap = await db.collection('products').orderBy('createdAt','desc').get();
    PRODUCTS = snap.docs.map(d=> ({ id:d.id, ...d.data() }));
    if (!PRODUCTS.length) {
      const batch = db.batch();
      DEMO.forEach(p=>{
        const ref=db.collection('products').doc();
        batch.set(ref, { ...p, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
      });
      await batch.commit();
      await loadProducts();
    }
  }

  async function createOrUpdateProduct(data) {
    if (usingDemo) {
      if (data.id?.startsWith('demo-')) {
        PRODUCTS = PRODUCTS.map(p=> p.id===data.id ? data : p);
      } else {
        data.id = 'demo-'+(PRODUCTS.length+1);
        PRODUCTS.unshift(data);
      }
      render();
      return;
    }
    if (data.id) {
      const {id, ...rest}=data;
      await db.collection('products').doc(id).set(rest, {merge:true});
    } else {
      await db.collection('products').add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
    }
  }

  async function deleteProduct(id) {
    if (usingDemo) {
      PRODUCTS = PRODUCTS.filter(p=>p.id!==id);
      render();
      return;
    }
    await db.collection('products').doc(id).delete();
  }

  // =========================
  // RENDER
  // =========================
  function affiliateUrl(url) {
    try {
      const u = new URL(url);
      if (!u.searchParams.has('tag')) u.searchParams.set('tag', AMAZON_TAG);
      return u.toString();
    } catch {
      return url;
    }
  }

  function filteredProducts() {
    const t = FILTER.text.trim().toLowerCase();
    const c = FILTER.cat;
    return PRODUCTS.filter(p=>{
      const okCat = c==='all' || (p.cat||'').toLowerCase()===c.toLowerCase();
      const okText = !t || (p.title||'').toLowerCase().includes(t) || (p.cat||'').toLowerCase().includes(t);
      return okCat && okText;
    });
  }

  function productCard(p) {
    const price = p.price ? `$${Number(p.price).toFixed(2)}` : '';
    const url = affiliateUrl(p.url||'#');
    return `
      <article class="group rounded-2xl overflow-hidden border border-white/10 bg-white/[0.03] hover:bg-white/[0.05] transition">
        <div class="aspect-[4/3] overflow-hidden">
          <img src="${p.img}" alt="${escapeHtml(p.title)}" class="h-full w-full object-cover group-hover:scale-[1.03] transition duration-300">
        </div>
        <div class="p-4">
          <h3 class="font-bold line-clamp-2">${escapeHtml(p.title)}</h3>
          <div class="mt-1 text-xs text-white/60">${escapeHtml(p.cat||'')}</div>
          <div class="mt-2 flex items-center justify-between">
            <span class="font-semibold">${price}</span>
            <!-- Corregido: sponsored en rel, sin cambiar estilo -->
            <a href="${url}" target="_blank" rel="nofollow sponsored noopener" class="btn-neo text-sm px-3 py-2" title="Ver en Amazon">Ver en Amazon</a>
          </div>
          ${ADMIN ? `
          <div class="mt-3 flex gap-2">
            <button class="btn-ghost text-sm" data-edit="${p.id}">Editar</button>
            <button class="btn-ghost text-sm" data-del="${p.id}">Eliminar</button>
          </div>`:''}
        </div>
      </article>
    `;
  }

  function render() {
    const list = filteredProducts();
    grid.innerHTML = list.map(productCard).join('');
    empty.classList.toggle('hidden', list.length>0);

    if (ADMIN) {
      $$("[data-edit]").forEach(b=>{
        b.onclick = ()=>{
          const id = b.getAttribute('data-edit');
          const p = PRODUCTS.find(x=>x.id===id);
          if (!p) return;
          fId.value = p.id;
          fTitle.value = p.title||'';
          fCat.value = p.cat||'';
          fPrice.value = p.price||'';
          fImg.value = p.img||'';
          fUrl.value = p.url||'';
          dlgForm.showModal();
        };
      });
      $$("[data-del]").forEach(b=>{
        b.onclick = async ()=>{
          const id = b.getAttribute('data-del');
          if (confirm("¿Eliminar este producto?")) {
            await deleteProduct(id);
            await loadProducts();
            render();
          }
        };
      });
      btnAdd.classList.remove('hidden');
    } else {
      btnAdd.classList.add('hidden');
    }
  }

  // =========================
  // EVENTOS UI
  // =========================
  $$("button[data-cat]").forEach(btn=>{
    btn.addEventListener('click', ()=>{
      FILTER.cat = btn.getAttribute('data-cat');
      render();
    });
  });

  searchInput.addEventListener('input', ()=>{
    FILTER.text = searchInput.value;
    render();
  });
  clearSearch.addEventListener('click', ()=>{
    searchInput.value = '';
    FILTER.text = '';
    render();
  });

  function askAdmin() {
    const pin = prompt("Ingresa PIN de Admin (sugerido: 360):","");
    if (pin === "360") { ADMIN = true; alert("Modo Admin activado"); }
    else { ADMIN = false; alert("PIN incorrecto"); }
    render();
  }
  btnAdmin.addEventListener('click', askAdmin);
  btnAdminSm.addEventListener('click', askAdmin);

  btnAdd.addEventListener('click', ()=>{
    fId.value = "";
    fTitle.value = "";
    fCat.value = "Tecnología";
    fPrice.value = "";
    fImg.value = "";
    fUrl.value = "";
    dlgForm.showModal();
  });

  productForm.addEventListener('submit', async (e)=>{
    e.preventDefault();
    const data = {
      id: fId.value || null,
      title: fTitle.value.trim(),
      cat: fCat.value.trim(),
      price: fPrice.value ? Number(fPrice.value) : null,
      img: fImg.value.trim(),
      url: fUrl.value.trim()
    };
    if (!data.title || !data.cat || !data.img || !data.url) {
      alert("Completa título, categoría, imagen y URL de Amazon.");
      return;
    }
    await createOrUpdateProduct(data);
    await loadProducts();
    render();
    dlgForm.close();
  });

  // =========================
  // HELPERS
  // =========================
  function escapeHtml(s=""){ return s.replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[c])) }
  </script>
</body>
</html>
