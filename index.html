<!DOCTYPE html>
<html lang="es" class="h-full bg-[#0b0f1a]">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J_A MEGA STORE 360</title>
  <meta name="theme-color" content="#0b0f1a"/>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json?v=6" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192-v6.png?v=6">
  <link rel="apple-touch-icon" href="icon-180x180-v6.png?v=6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { outfit: ['Outfit','ui-sans-serif','system-ui']},
          colors: { base:'#0b0f1a', card:'#12172a', soft:'#1a2140' }
        }
      }
    }
  </script>

  <!-- Fuente -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --grad-1: linear-gradient(135deg,#00E5FF 0%,#7C3AED 50%,#FF0099 100%);
      --btn-grad: linear-gradient(135deg,#00E5FF 0%,#7C3AED 50%,#FF0099 100%);
      --ring: 0 0 0 1.5px rgba(124,58,237,.45),0 0 18px rgba(124,58,237,.35),inset 0 0 12px rgba(0,229,255,.25);
    }
    body { font-family:'Outfit',sans-serif }
    .neon-title { background:var(--grad-1);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 0 18px rgba(124,58,237,.25) }
    .btn-neon { background:var(--btn-grad);color:#0b0f1a;font-weight:800;box-shadow:0 0 24px rgba(124,58,237,.35);transition:transform .12s,box-shadow .12s }
    .btn-neon:hover { transform:translateY(-1px) scale(1.01);box-shadow:0 0 32px rgba(124,58,237,.55) }
    .chip { background:rgba(124,58,237,.15);border:1px solid rgba(124,58,237,.35) }
    .card { background:#12172a;border:1px solid rgba(124,58,237,.25) }
    .input { background:#0e1430;border:1px solid rgba(124,58,237,.35);outline:none;color:white;border-radius:12px;padding:.7rem .9rem }
    .input:focus { box-shadow:var(--ring) }
    html,body{max-width:100%;overflow-x:hidden}
  </style>
</head>

<body class="min-h-full text-white bg-[radial-gradient(1200px_600px_at_20%_-10%,rgba(124,58,237,.15),transparent_55%),radial-gradient(900px_500px_at_120%_10%,rgba(0,229,255,.12),transparent_50%),#0b0f1a]">

  <!-- Header -->
  <header class="sticky top-0 z-30 bg-[#0b0f1a]/90 backdrop-blur-md border-b border-white/10">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl bg-[#12172a] flex items-center justify-center font-extrabold">J_A</div>
        <div>
          <h1 class="text-2xl font-extrabold neon-title">MEGA STORE 360</h1>
          <p class="text-xs text-white/70 -mt-1">Tecnología • Hogar • Belleza</p>
        </div>
      </div>
      <a href="https://www.youtube.com/@SABIDURIAANIMAL86" target="_blank" class="chip px-3 py-2 rounded-xl text-sm font-semibold hover:opacity-90">YouTube</a>
    </div>
  </header>

  <!-- Barra de controles -->
  <section class="max-w-7xl mx-auto px-4 mt-4 grid gap-3 sm:grid-cols-[1fr_auto_auto_auto]">
    <div class="gradient-border">
      <input id="search" class="input w-full" placeholder="Buscar productos…" />
    </div>
    <select id="categoryFilter" class="input">
      <option value="all">Todas las categorías</option>
    </select>
    <button id="btnAdd" class="btn-neon px-4 py-2 rounded-xl text-sm disabled:opacity-40" disabled>+ Agregar</button>
    <button id="btnFeaturedTop" class="btn-neon px-4 py-2 rounded-xl text-sm">★ Destacados</button>
  </section>

  <!-- Grid -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="grid" class="grid gap-4 grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
    <p id="empty" class="hidden text-center text-white/60 mt-10">No hay productos que coincidan.</p>
  </main>

  <!-- Footer -->
  <footer class="border-t border-white/10 py-8">
    <div class="max-w-7xl mx-auto px-4 text-sm text-white/60">
      <div class="flex flex-wrap items-center gap-2">
        <span class="font-semibold">Aviso Amazon Afiliados:</span>
        <span>Como afiliado de Amazon, puedo ganar comisiones por compras calificadas.</span>
      </div>
      <div class="mt-2">© <span id="year"></span> J_A MEGA STORE 360 — Todos los derechos reservados.</div>
    </div>
  </footer>

  <!-- ===== MODAL DESTACADOS ===== -->
  <dialog id="featuredModal" class="backdrop:bg-black/70 rounded-2xl w-[min(1100px,94vw)]">
    <form method="dialog" class="card rounded-2xl p-4 sm:p-6">
      <div class="flex items-center justify-between mb-3">
        <div>
          <h3 class="text-lg font-extrabold neon-title">⭐ Productos destacados</h3>
          <p class="text-xs text-white/60">Incluye los destacados y todas las cafeteras.</p>
        </div>
        <button class="chip px-3 py-1.5 rounded-xl text-sm">Cerrar</button>
      </div>
      <div class="mb-3 flex items-center gap-2">
        <label class="text-xs text-white/70">Ordenar:</label>
        <select id="featuredOrder" class="input">
          <option value="default">Predeterminado</option>
          <option value="titleAsc">Título (A–Z)</option>
          <option value="titleDesc">Título (Z–A)</option>
        </select>
      </div>
      <div id="featuredGrid" class="grid gap-4 grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
      <p id="featuredEmpty" class="hidden text-center text-white/60 mt-6">Sin destacados por ahora.</p>
    </form>
  </dialog>

  <!-- ===== LÓGICA DESTACADOS ===== -->
  <script>
  (function(){
    const TAG="kaninosabioan-20",LS_KEY="ja_store_products_v2";
    const btn=document.getElementById("btnFeaturedTop"),
          modal=document.getElementById("featuredModal"),
          grid=document.getElementById("featuredGrid"),
          empty=document.getElementById("featuredEmpty"),
          orderSel=document.getElementById("featuredOrder");
    function lsLoad(){try{return JSON.parse(localStorage.getItem(LS_KEY))||[]}catch{return[]}}
    function rawCatalog(){
      try{
        if(window.PRODUCTOS&&window.PRODUCTOS.PRODUCTOS){
          const obj=window.PRODUCTOS.PRODUCTOS;
          return Object.entries(obj).map(([id,p])=>({id,title:p.TITLE,image:p.IMAGE,amazon:p.AMAZON,price:p.PRICE||"",category:p.CATEGORY||"Otros",featured:!!p.FEATURE}));
        }
      }catch{}
      return[];
    }
    function getAllProducts(){const a=lsLoad();return a.length?a:rawCatalog()}
    function ensureTag(url){if(!url)return"#";try{const u=new URL(url,location.href);u.searchParams.set("tag",TAG);return u.toString()}catch{const sep=url.includes("?")?"&":"?";return url+sep+"tag="+TAG}}
    const COFFEE_RE=/(café|cafeter|espresso|barista|keurig|gevi)/i;
    function isCoffee(p){const t=(p.title||"")+(p.category||"");return COFFEE_RE.test(t)}
    function gatherFeatured(){
      const list=getAllProducts();const feats=list.filter(p=>p.featured||isCoffee(p));
      const map=new Map();feats.forEach(p=>{const k=p.id||(p.title||"").toLowerCase();if(!map.has(k))map.set(k,p)});return[...map.values()];
    }
    function productCard(p){
      const price=p.price?`<div class='mt-1 text-white/90 font-semibold'>$${Number(p.price).toLocaleString()}</div>`:"";
      return`
      <article class='card rounded-2xl p-3 sm:p-4'>
        <div class='rounded-xl overflow-hidden bg-soft aspect-[4/3]'>
          <img src='${p.image}' alt='${p.title}' class='w-full h-full object-cover' loading='lazy'>
        </div>
        <div class='mt-3'>
          <h3 class='font-extrabold line-clamp-2'>${p.title}</h3>
          <div class='flex items-center gap-2 mt-1 text-xs text-white/60'>
            <span>${p.category}</span>${p.featured?`<span class='text-white/20'>•</span><span class='tag text-[10px] px-2 py-0.5 rounded-lg font-semibold'>Destacado</span>`:""}
          </div>
          ${price}
          <a href='${ensureTag(p.amazon)}' target='_blank' class='btn-neon w-full mt-3 rounded-xl py-2 block text-center font-semibold'>Ver en Amazon</a>
        </div>
      </article>`;}
    function sortList(list,mode){const arr=[...list];if(mode==="titleAsc")arr.sort((a,b)=>a.title.localeCompare(b.title));if(mode==="titleDesc")arr.sort((a,b)=>b.title.localeCompare(a.title));return arr}
    function render(){const feats=sortList(gatherFeatured(),orderSel.value||"default");grid.innerHTML=feats.map(productCard).join("");empty.classList.toggle("hidden",feats.length>0)}
    btn.addEventListener("click",()=>{render();modal.showModal()});orderSel.addEventListener("change",render);
    window.addEventListener("ja_products_updated",()=>{if(modal.open)render()});
  })();
  </script>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
</body>
</html>
