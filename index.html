<!DOCTYPE html>
<html lang="es" class="h-full bg-[#0b0f1a]">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>J_A MEGA STORE 360</title>
  <meta name="theme-color" content="#0b0f1a"/>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json?v=7" />
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192x192-v7.png?v=7">
  <link rel="apple-touch-icon" href="icon-180x180-v7.png?v=7">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { outfit: ['Outfit','ui-sans-serif','system-ui']},
          colors: { base:'#0b0f1a', card:'#12172a', soft:'#1a2140' }
        }
      }
    }
  </script>

  <!-- Fuente -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --grad-1: linear-gradient(135deg,#00E5FF 0%, #7C3AED 50%, #FF0099 100%);
      --btn-grad: linear-gradient(135deg, #00E5FF 0%, #7C3AED 50%, #FF0099 100%);
      --ring: 0 0 0 1.5px rgba(124,58,237,.45), 0 0 18px rgba(124,58,237,.35), inset 0 0 12px rgba(0,229,255,.25);
    }
    body{ font-family:'Outfit',sans-serif }
    .neon-title{ background:var(--grad-1); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow:0 0 18px rgba(124,58,237,.25) }
    .btn-neon{ background:var(--btn-grad); color:#0b0f1a; font-weight:800; box-shadow:0 0 24px rgba(124,58,237,.35); transition:transform .12s, box-shadow .12s, opacity .12s }
    .btn-neon:hover{ transform:translateY(-1px) scale(1.005); box-shadow:0 0 32px rgba(124,58,237,.55) }
    .chip{ background:rgba(124,58,237,.15); border:1px solid rgba(124,58,237,.35) }
    .card{ background:radial-gradient(1200px 500px at -10% -10%, rgba(124,58,237,.12), transparent 50%), radial-gradient(1000px 400px at 120% 120%, rgba(0,229,255,.10), transparent 45%), #12172a; border:1px solid rgba(124,58,237,.25) }
    .toolbar{ background:linear-gradient(180deg, rgba(18,23,42,.85), rgba(18,23,42,.6) 60%, rgba(18,23,42,.1)); border-bottom:1px solid rgba(124,58,237,.25); backdrop-filter:blur(8px) }
    .gradient-border{ position:relative; border-radius:16px; overflow:hidden }
    .gradient-border::before{ content:''; position:absolute; inset:0; padding:1px; border-radius:16px; background:var(--grad-1);
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite:xor; mask-composite:exclude; pointer-events:none }
    .input{ background:#0e1430; border:1px solid rgba(124,58,237,.35); outline:none; color:white; border-radius:12px; padding:.7rem .9rem }
    .input:focus{ box-shadow:var(--ring) }
    html, body { max-width:100%; overflow-x:hidden; }
    body { touch-action: pan-y; overscroll-behavior-x: none; }
    #grid { overflow-x:hidden; }
    *, *::before, *::after { box-sizing:border-box; }

    .admin-only{ display:none !important; }
    .is-admin .admin-only{ display:inline-flex !important; }

    .header-admin-btn{ display:none !important; }
    .is-admin .header-admin-btn{ display:inline-flex !important; }

    .logo-chip{ background:#fff !important; border:1px solid rgba(255,255,255,.12) }
    .logo-chip img{ display:block; height:24px; width:auto; max-width:92px }
    @media (min-width:640px){ .logo-chip img{ height:26px } }

    .no-scroll{ position:fixed; overflow:hidden; width:100%; }
  </style>

  <style>
    :root { --ms360-ring: 0 0 0 1.5px rgba(124,58,237,.45), 0 0 18px rgba(124,58,237,.35), inset 0 0 12px rgba(0,229,255,.25) }
    :focus-visible { outline:2px solid #7C3AED; outline-offset:2px }
    .ms360-skeleton{position:relative;overflow:hidden;background:#0f1430}
    .ms360-skeleton::after{content:"";position:absolute;inset:0;background:linear-gradient(90deg,transparent,rgba(255,255,255,.08),transparent);transform:translateX(-100%);animation:ms360-shimmer 1.1s infinite}
    #ms360-top{position:fixed;right:14px;bottom:14px;z-index:9998;opacity:0;pointer-events:none;transform:translateY(8px);transition:opacity .2s, transform .2s}
    #ms360-top.ms360-show{opacity:1;pointer-events:auto;transform:translateY(0)}
    #ms360-toasts{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);z-index:10000;display:grid;gap:8px}
    .ms360-ibtn{display:inline-flex;align-items:center;justify-content:center;width:36px;height:36px;border-radius:10px;background:rgba(14,20,48,.75);border:1px solid rgba(255,255,255,.12);color:#fff;backdrop-filter:blur(6px);transition:transform .12s,border-color .12s}
    .ms360-ibtn:hover{transform:translateY(-1px) scale(1.03);border-color:rgba(255,255,255,.25)}
  </style>

  <style>#fabDestacados, #btnDestacadosHeader { display: none !important; }</style>

  <style id="ms360-tiles-essence">
    html.ms360-tiles #grid{ display:grid !important; grid-template-columns:repeat(3,minmax(0,1fr)) !important; gap:12px !important; }
    html.ms360-tiles #grid .card{
      background:
        radial-gradient(900px 480px at 110% -10%, rgba(0,229,255,.08), transparent 55%),
        radial-gradient(900px 480px at -10% 120%, rgba(124,58,237,.10), transparent 50%),
        #12172a !important;
      border:1px solid rgba(124,58,237,.22) !important;
      box-shadow:0 10px 28px rgba(0,0,0,.35) !important;
      color:#E7ECFF !important;
      border-radius:18px !important;
      padding:10px !important;
    }
    html.ms360-tiles #grid .card .aspect-\[4\/3\]{ aspect-ratio:1/1 !important; background:#fff !important; border-radius:14px !important; padding:8px !important; position:relative; overflow:hidden; }
    html.ms360-tiles #grid .card .aspect-\[4\/3\]::before{
      content:""; position:absolute; inset:0; padding:1px; border-radius:14px; background:var(--grad-1);
      -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite:xor; mask-composite:exclude; pointer-events:none; opacity:.45;
    }
    html.ms360-tiles #grid .card .aspect-\[4\/3\] img{ object-fit:contain !important; width:100% !important; height:100% !important; mix-blend:multiply; filter:saturate(1.02) contrast(1.02); }
    html.ms360-tiles #grid .card h3{
      color:#fff !important; font-weight:800 !important; font-size:13px !important; line-height:1.25 !important; text-align:center !important; margin-top:10px !important;
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; min-height:2.6em; text-shadow:0 0 14px rgba(124,58,237,.22);
    }
    html.ms360-tiles #grid .card a.btn-neon{ width:100% !important; justify-content:center !important; padding:8px 10px !important; font-size:12px !important; border-radius:10px !important; margin-top:10px !important; transform:none !important; }
    html.ms360-tiles #grid .card a.btn-neon:hover{ transform:none !important; }
    @media (min-width:640px){ html.ms360-tiles #grid{ grid-template-columns:repeat(4,minmax(0,1fr)) !important; } }
    @media (min-width:1024px){ html.ms360-tiles #grid{ grid-template-columns:repeat(5,minmax(0,1fr)) !important; } }
  </style>

  <style>
    header .flex-1 h1{
      background: var(--grad-1) !important;
      -webkit-background-clip: text !important; background-clip: text !important;
      color: transparent !important; text-shadow: 0 0 18px rgba(124,58,237,.25) !important;
      white-space: nowrap !important; overflow: hidden; text-overflow: ellipsis;
      font-weight: 900 !important; letter-spacing: .02em;
      font-size: clamp(18px, 6vw, 34px); line-height: 1.05; margin-bottom:.35rem;
    }
    header .flex-1 > p{ display:none !important; }

    .header-ctas--icons{
      display:flex; gap:.55rem; justify-content:flex-end; align-items:center;
      flex-wrap:nowrap; white-space:nowrap; margin-top:.35rem;
    }
    .cta-icon{
      display:inline-flex; align-items:center; justify-content:center;
      width:40px; height:40px; border-radius:12px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
      overflow:hidden;
    }
    .cta-icon:hover{ transform:translateY(-1px) scale(1.02); border-color:rgba(255,255,255,.25); }
    .cta-icon img, .cta-icon svg{ display:block; width:26px; height:26px; }
    .cta-amz{ background:#fff; }
    .cta-amz img{ width:28px; height:auto; }
    @media (max-width:360px){
      .cta-icon{ width:36px; height:36px; border-radius:10px; }
      .cta-amz img{ width:26px; }
    }
    header .max-w-7xl > a[href*="youtube.com"],
    header .max-w-7xl > a.logo-chip{ display:none !important; }
  </style>
</head>

<body class="min-h-full text-white bg-[radial-gradient(1200px_600px_at_20%_-10%,rgba(124,58,237,.15),transparent_55%),radial-gradient(900px_500px_at_120%_10%,rgba(0,229,255,.12),transparent_50%),#0b0f1a]">

  <!-- HEADER -->
  <header class="toolbar sticky top-0 z-30">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
      <div id="brandTrigger" class="w-10 h-10 rounded-xl gradient-border flex items-center justify-center shrink-0 select-none">
        <div class="w-full h-full rounded-[14px] bg-[#0e1430] flex items-center justify-center">
          <span class="text-xl font-extrabold neon-title">J_A</span>
        </div>
      </div>

      <div class="flex-1">
        <h1 class="text-xl sm:text-2xl font-extrabold neon-title leading-none">MEGA STORE 360</h1>
        <div class="header-ctas--icons">
          <a class="cta-icon" href="https://www.youtube.com/@SABIDURIAANIMAL86" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" alt="YouTube"></a>
          <a class="cta-icon" href="https://www.instagram.com/mega_store_360/" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram"></a>
          <a class="cta-icon cta-amz" href="https://www.amazon.com/?tag=kaninosabioan-20" target="_blank"><img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Amazon_logo.svg" alt="Amazon"></a>
        </div>
      </div>
    </div>
  </header>

  <!-- MAIN SECTION -->
  <main class="max-w-7xl mx-auto px-4 py-6">
    <div id="grid" class="grid gap-4 grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
    <p id="empty" class="hidden text-center text-white/60 mt-10">No hay productos que coincidan.</p>
  </main>

  <footer class="border-t border-white/10 py-8 text-center text-white/60 text-sm">© <span id="year"></span> J_A MEGA STORE 360 — Todos los derechos reservados.</footer>

  <script type="module">
    const AFF_TAG = "kaninosabioan-20";
    const LS_KEY  = 'ja_store_products_v2';
    const LS_FEATURED = 'ja_featured_ids_v1';
    const MIGRATION_FLAG = 'ja_migrated_2025_10_08_fix_ids_v7';

    if (!localStorage.getItem(MIGRATION_FLAG)) {
      try { localStorage.removeItem(LS_KEY); localStorage.removeItem(LS_FEATURED); } catch {}
      localStorage.setItem(MIGRATION_FLAG, '1');
    }

    const feat = {
      get(){ try{return JSON.parse(localStorage.getItem(LS_FEATURED))||[]}catch{return[]} },
      set(v){ localStorage.setItem(LS_FEATURED, JSON.stringify(v||[])) },
      has(id){ return feat.get().includes(id) },
      toggle(id){ const s=new Set(feat.get()); s.has(id)?s.delete(id):s.add(id); feat.set([...s]) }
    };

    function ensureTag(url){
      if(!url) return "#";
      try{
        const u=new URL(url,location.href);
        if(/amazon\./i.test(u.hostname)) u.searchParams.set("tag", AFF_TAG);
        return u.toString();
      }catch{
        const sep=url.includes("?")?"&":"?";
        return `${url}${sep}tag=${AFF_TAG}`;
      }
    }

    const norm = (p)=>({
      id:(p.id||'').trim(), title:(p.title||p.TITLE||'').trim(), image:(p.image||p.IMAGE||'').trim(),
      amazon:ensureTag(p.amazon||p.AMAZON||'#'), price:p.price??p.PRICE??'', category:(p.category||p.CATEGORY||'Otros').trim(),
      featured:!!(p.featured??p.FEATURE), createdAt:typeof p.createdAt==='number'?p.createdAt:Date.now()
    });

    let products=[]; const grid=document.getElementById('grid'); const empty=document.getElementById('empty');
    const year=document.getElementById('year'); year.textContent=new Date().getFullYear();

    function productCard(p){
      return `<article class="card rounded-2xl p-3 sm:p-4 flex flex-col gradient-border relative">
        <div class="rounded-xl overflow-hidden bg-soft aspect-[4/3]">
          <img src="${p.image}${p.image?.includes('?')?'&':'?'}v=${encodeURIComponent(p.createdAt||Date.now())}" alt="${p.title}" class="w-full h-full object-contain" loading="lazy"
          onerror="this.onerror=null;this.src='https://via.placeholder.com/800x600?text=Imagen';">
        </div>
        <div class="mt-3">
          <h3 class="font-extrabold leading-tight line-clamp-2 text-center">${p.title}</h3>
          <div class="mt-1 text-center text-xs text-white/60">${p.category}</div>
          <a href="${ensureTag(p.amazon)}" target="_blank" rel="nofollow sponsored noopener" class="btn-neon w-full justify-center px-4 py-2 rounded-xl inline-flex items-center gap-2 mt-3">Ver en Amazon</a>
        </div></article>`;
    }

    function applyFilters(){ grid.innerHTML=products.map(productCard).join(''); empty.classList.toggle('hidden',!!products.length); }

    function loadLocal(){ try{ const raw=localStorage.getItem(LS_KEY); const list=raw?JSON.parse(raw):[]; return Array.isArray(list)?list.map(norm):[] }catch{return []} }
    function saveLocal(list){ localStorage.setItem(LS_KEY, JSON.stringify(list)); }

    products=loadLocal(); applyFilters();

    (function(){
      const RAW_URL = "https://raw.githubusercontent.com/jefersonsalazar2000-gif/STORE-3/main/products.json";
      const REFRESH_MS = 30000;
      async function pull(){
        try{
          const res = await fetch(RAW_URL + "?" + Date.now(), { cache:"no-store" });
          if(!res.ok) throw new Error("HTTP "+res.status);
          const json = await res.json();
          const incoming = Object.entries(json.PRODUCTOS||{}).map(([id,data])=>({...data,id})).map(norm);
          saveLocal(incoming); products=loadLocal(); applyFilters();
          console.log("✅ Auto-sync OK: productos =", products.length);
        }catch(e){ console.warn("❌ Error cargando products.json:", e); }
      }
      pull(); setInterval(pull, REFRESH_MS);
    })();
  </script>
</body>
</html>
